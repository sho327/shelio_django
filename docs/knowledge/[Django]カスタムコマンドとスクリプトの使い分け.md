📘 Django / カスタムコマンドとスクリプトの使い分け

---

Django プロジェクト内でデータ操作やユーティリティ処理を行う際、カスタム管理コマンド (`management/commands`) と、シェルスクリプト (`scripts/`) のどちらを使うかは、**その処理の目的と実行環境**によって決定します。

## 1. 🥇 カスタム管理コマンドを選ぶべきケース

管理コマンドは、Django の公式な拡張メカニズムであり、**永続的な運用作業**のために設計されています。

### 🚀 選定基準

- **永続的な運用タスク:** Cron ジョブなどにより、**定期的・自動的**に実行したいタスク（例: 期限切れセッションのクリーンアップ）。
- **汎用的な初期化:** プロジェクトの初期設定や、どの環境でも同じ手順で実行する**初期データ投入**（例: `initdata`）。
- **標準的なインターフェース:** 誰でも `python manage.py コマンド名` で簡単に実行できる、**標準化されたインターフェース**が必要な場合。
- **強力な引数処理:** オプションや引数を**標準で強力にパース**したい場合。

### 📂 配置と実行

| 項目             | 詳細                                                              |
| :--------------- | :---------------------------------------------------------------- |
| **ファイルパス** | `[アプリ名]/management/commands/[コマンド名].py`                  |
| **アプリ登録**   | **必須**（`INSTALLED_APPS` に登録されたアプリ内である必要がある） |
| **実行コマンド** | `python manage.py [コマンド名]`                                   |

---

## 2. 🥈 シェルスクリプトを選ぶべきケース

シェルスクリプトは、**一時的なデータ修正や開発・テストのための操作**に特化しています。

### 🔍 選定基準

- **一度限りの修正 (One-off):** 本番環境で**緊急に**特定のデータを修正・移行する場合（例: `fix_legacy_data.py`）。
- **開発/テストデータ生成:** 開発やステージング環境でのみ必要な、**テストユーザーやダミーコンテンツの大量生成**（例: `generate_test_user.py`）。
- **迅速なデバッグ:** 複雑なモデルやロジックをインポートし、デバッグや検証のためのロジックを**素早く試したい**場合。

### 📂 配置と実行

| 項目             | 詳細                                                                                    |
| :--------------- | :-------------------------------------------------------------------------------------- |
| **ファイルパス** | `core/scripts/[スクリプト名].py` など、**専用の非標準ディレクトリ**                     |
| **環境ロード**   | **手動**で `from django.db import transaction` など必要なモジュールをインポートして実行 |
| **実行コマンド** | `python manage.py shell` 後にインポートして実行、または `python [ファイル名].py`        |

---

## 3. 💡 まとめ：判断基準

タスクが**「Django のコアな運用の一部」**であるなら管理コマンドを、**「一時的なデータ操作や開発の補助」**であるならシェルスクリプトを選ぶのがベストプラクティスです。
