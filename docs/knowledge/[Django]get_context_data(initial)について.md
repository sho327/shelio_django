📘 Django / get_context_data(initial)について

---

## 🧐 1. `get_context_data`：テンプレートへ渡すデータの取得

`get_context_data(self, **kwargs)` は、ビューが**テンプレートに渡すコンテキスト辞書**を作成するために使用されます。

このメソッドは、**`TemplateView`** や **`FormView`** のレンダリングプロセス中に呼び出され、テンプレートで使用される追加のデータを設定するのに最適です。

| 項目         | 説明                                                                                                                                                                                                    |
| :----------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **役割**     | テンプレートがレンダリングされる前に、**追加のデータを取得し、コンテキスト辞書に格納**する。                                                                                                            |
| **呼び出し** | `TemplateView` や `FormView` が GET リクエストを処理する際（テンプレートを返す前）。                                                                                                                    |
| **用途**     | \* サイドバーに表示する**静的データ**を取得する。\* ログインユーザーの**最新の通知リスト**など、フォームとは無関係な DB データを取得する。\* テンプレート内で使用する**フォーム以外の変数**を設定する。 |

**処理のイメージ:**

```python
# 例: プロフィール編集画面 (TemplateView or FormView)
def get_context_data(self, **kwargs):
    # 既存のコンテキスト（FormViewならformオブジェクトなど）を取得
    context = super().get_context_data(**kwargs)

    # テンプレートに追加したいデータをDBから取得
    context['latest_posts'] = Post.objects.filter(author=self.request.user)[:5]
    context['is_admin'] = self.request.user.is_staff

    return context # この辞書がテンプレートに渡される
```

---

## 🧐 2. `get_initial`：フォームの初期値の設定

`get_initial(self)` は、**フォームのフィールドに初期値を設定する**ために使用されます。

これは、ユーザーがフォームを初めて開いたときや、編集フォームのように既存のデータを表示したい場合に特に役立ちます。

| 項目         | 説明                                                                                                                                                                   |
| :----------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **役割**     | フォームクラスがインスタンス化される前に、**フィールドの初期値を辞書形式で提供**する。                                                                                 |
| **呼び出し** | `FormView` が GET リクエストを処理し、フォームを初期化する直前。                                                                                                       |
| **用途**     | \* 編集画面で、**既存のオブジェクトの値**をフォームフィールドに設定する。\* フォームに**デフォルトの固定値**を設定する（例: ユーザーのメールアドレスを初期値にする）。 |

**処理のイメージ:**

```python
# 例: 編集画面 (FormView or UpdateView)
def get_initial(self):
    # 既存の初期値を取得 (通常は空の辞書)
    initial = super().get_initial()

    # ユーザーの既存のプロフィールデータを取得
    user_profile = self.request.user.profile

    # フォームフィールド名に合わせて初期値を設定
    initial['name'] = user_profile.display_name
    initial['bio'] = user_profile.biography

    return initial # この辞書がフォームの initial パラメータとして渡される
```

---

## 🔄 違いのまとめ

| メソッド               | 影響を与える対象             | 返す値の形式                   | DB アクセスの主な目的                                        |
| :--------------------- | :--------------------------- | :----------------------------- | :----------------------------------------------------------- |
| **`get_context_data`** | **テンプレート全体**         | 辞書 (`{'key': value}`)        | フォーム以外のデータ、リスト、サマリーなど。                 |
| **`get_initial`**      | **フォームの入力フィールド** | 辞書 (`{'field_name': value}`) | フォームを編集するために必要な**単一オブジェクトのデータ**。 |
