{% extends "core/auth/base.html" %}
{% load static %}

{% block title %}åˆæœŸè¨­å®š - {{ SITE_NAME }}{% endblock %}

{# --- HEAD/CSS --- #}
{% block extra_head_css %}
<style>
    /* ä¸­å¤®é…ç½®ã®ãŸã‚ã®CSS */
    .login-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 1rem;
    }
</style>
{% endblock %}


{# --- Alpine.js Data --- #}
{% block extra_js_scripts %}
<script>
    function profileData() {
        return {
            // display_name ã®åˆæœŸå€¤ã¯Djangoã‹ã‚‰å—ã‘å–ã‚‹
            displayName: "{{ form.display_name.value|default_if_none:'' }}", 
            
            submitProfile() {
                // Djangoæ¨™æº–ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã«æˆ»ã™
                this.$refs.djangoForm.submit();
            }
        }
    }
</script>
{% endblock %}


{# --- CONTENT --- #}
{% block content %}

<div class="login-container" x-data="profileData()">
  
  <div class="text-center mb-6">
    <h1 class="text-4xl font-bold text-primary">{{ SITE_NAME }}</h1>
    <p class="text-lg text-base-content/70 mt-2">ã‚ˆã†ã“ãï¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’åˆæœŸè¨­å®šã—ã¦ãã ã•ã„</p>
  </div>

  <div class="card w-full max-w-lg bg-base-100 shadow-2xl p-8">
    
    {# Djangoæ¨™æº–ã®ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã‚’åˆ©ç”¨ #}
    <form class="card-body p-0" method="post" action="" x-ref="djangoForm" enctype="multipart/form-data">
      {% csrf_token %}
      
      {# ãƒ•ã‚©ãƒ¼ãƒ ã®å…¨ä½“ã‚¨ãƒ©ãƒ¼è¡¨ç¤º #}
      {% if form.non_field_errors %}
          <div role="alert" 
               class="bg-red-100 text-red-700 border border-red-400 p-3 rounded-md text-sm flex items-start">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-5 w-5 mr-3 mt-0.5" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div>
                  {% for error in form.non_field_errors %}
                      <span class="font-medium block">{{ error }}</span>
                  {% endfor %}
              </div>
          </div>
      {% endif %}

      {# 1. è¡¨ç¤ºå (display_name) ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (å¿…é ˆ) #}
      {% with field=form.display_name %}
        <div class="form-control mb-4">
          <label class="label">
            <span class="label-text font-bold">{{ field.label }} <span class="text-error">*</span></span>
          </label>
          <input type="text" 
               name="{{ field.name }}"
               id="{{ field.id_for_label }}"
               placeholder="ä¾‹: Kenji_Dev" 
               class="input input-bordered w-full rounded-md {% if field.errors %}input-error{% endif %}" 
               x-model="displayName" 
               required
               value="{{ field.value|default_if_none:'' }}"/>
          
          {% if field.help_text %}
            <label class="label">
              <span class="label-text-alt text-base-content/70">{{ field.help_text }}</span>
            </label>
          {% endif %}
          
          {% if field.errors %}
            <label class="label pt-0">
              <span class="label-text-alt text-error">
                {% for error in field.errors %}{{ error }}{% endfor %}
              </span>
            </label>
          {% endif %}
        </div>
      {% endwith %}
      
      {# ----------------------------------------------------- #}
      {# 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ (icon) ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (æ¨å¥¨) #}
      {% with field=form.icon %}
        <div class="form-control mb-4">
          <label class="label">
            <span class="label-text font-bold">{{ field.label }}</span>
          </label>
          {# ImageFieldã¯input type="file" ã¨ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ #}
          <input type="file" 
               name="{{ field.name }}"
               id="{{ field.id_for_label }}"
               class="file-input file-input-bordered w-full rounded-md {% if field.errors %}input-error{% endif %}"/>
               
          {% if field.help_text %}
            <label class="label">
              <span class="label-text-alt text-base-content/70">{{ field.help_text }}</span>
            </label>
          {% endif %}

          {% if field.errors %}
            <label class="label pt-0">
              <span class="label-text-alt text-error">
                {% for error in field.errors %}{{ error }}{% endfor %}
              </span>
            </label>
          {% endif %}
        </div>
      {% endwith %}
      
      <div class="divider">è¨­å®š</div>
      
      {# 3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å…¬é–‹ (is_public) ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (æ¨å¥¨) #}
      {% with field=form.is_public %}
        <div class="form-control mb-2">
          <label class="label cursor-pointer p-0">
            <span class="label-text">{{ field.label }}</span>
            <input type="checkbox" 
                name="{{ field.name }}"
                id="{{ field.id_for_label }}"
                class="checkbox checkbox-sm checkbox-primary rounded-md" 
                {% if field.value %}checked{% endif %} />
          </label>
          {% if field.help_text %}
            <label class="label pt-0">
              <span class="label-text-alt text-base-content/70">{{ field.help_text }}</span>
            </label>
          {% endif %}
        </div>
      {% endwith %}
      
      {# 4. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ä¸€æ‹¬ON/OFF (is_email_notify_enabled) ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ (æ¨å¥¨) #}
      {# ğŸš¨ ä¿®æ­£: ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’ is_email_notify_enabled ã«å¤‰æ›´ #}
      {% with field=form.is_email_notify_enabled %}
        <div class="form-control mb-4">
          <label class="label cursor-pointer p-0">
            <span class="label-text">{{ field.label }}</span>
            <input type="checkbox" 
                name="{{ field.name }}"
                id="{{ field.id_for_label }}"
                class="checkbox checkbox-sm checkbox-primary rounded-md" 
                {% if field.value %}checked{% endif %} />
          </label>
          {% if field.help_text %}
            <label class="label pt-0">
              <span class="label-text-alt text-base-content/70">{{ field.help_text }}</span>
            </label>
          {% endif %}
        </div>
      {% endwith %}
      {# ----------------------------------------------------- #}
      
      <div class="form-control mt-4">
        {# Alpineã®submitLoginã‚’å‘¼ã³å‡ºã™ã‹ã€ç›´æ¥submitã«ã™ã‚‹ #}
        <button type="submit" 
                class="btn btn-primary rounded-md" 
                :disabled="!displayName"
                @click="submitProfile()">
          è¨­å®šã‚’å®Œäº†ã—ã¦ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
        </button>
      </div>
      
    </form>
  </div>
  
</div>

{% endblock %}