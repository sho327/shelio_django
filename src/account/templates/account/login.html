{% extends "core/auth/base.html" %}
{% load static %}

{% block title %}ログイン - Loclil{% endblock %}

{% block extra_head_css %}
<style>
    /* 中央配置のためのCSS */
    .login-container {
        display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		min-height: 100vh;
		padding: 1rem;
    }
</style>
{% endblock %}

{% block extra_js_scripts %}
<script>
    // Alpine.js フォームデータロジック (このページでのみ必要)
    function loginData() {
        return {
            // Djangoのフォームフィールド名に合わせて修正
            username: '', 
            password: '',
            remember_me: false, // フォームフィールド名に合わせる
            
            submitLogin() {
                // Django標準のフォーム送信に戻す
                this.$refs.djangoForm.submit();
            }
        }
    }
</script>
{% endblock %}


{% block content %}

{# ログインページ専用のレイアウトコンテナ #}
<div class="login-container" x-data="loginData()">
  
  <div class="text-center mb-6">
    <h1 class="text-4xl font-bold text-primary">Loclil</h1>
    <p class="text-lg text-base-content/70 mt-2">アカウントにログイン</p>
  </div>

  <div class="card w-full max-w-sm bg-base-100 shadow-2xl p-6">
    
    {# Django標準のフォーム送信を利用 #}
    <form class="card-body p-0" method="post" action="{% url 'login' %}" x-ref="djangoForm">
      {% csrf_token %}
      
      {# フォームの全体エラー表示 #}
      {% if form.non_field_errors %}
          {# ⭐ 修正箇所: alert alert-error をカスタム Tailwind スタイルに置き換え ⭐ #}
          <div role="alert" 
               class="bg-red-100 text-red-700 border border-red-400 p-3 rounded-md text-sm flex items-start">
              {# 警告アイコン (Tailwind/DaisyUI環境ならアイコンライブラリで置き換えてもOK) #}
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-5 w-5 mr-3 mt-0.5" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div>
                  {% for error in form.non_field_errors %}
                      <span class="font-medium block">{{ error }}</span>
                  {% endfor %}
              </div>
          </div>
      {% endif %}

      {# 1. Username (Email) フィールド #}
      {% with field=form.username %}
		<div class="form-control">
			<label class="label">
				<span class="label-text">{{ field.label_tag }}</span>
			</label>
			<input type="text" 
					name="{{ field.name }}"
					id="{{ field.id_for_label }}"
					placeholder="メールアドレスを入力してください" 
					class="input input-bordered w-full rounded-md {% if field.errors %}input-error{% endif %}" 
					x-model="username" 
					required 
					value="{{ field.value|default_if_none:'' }}"/>
			{% if field.errors %}
				<label class="label pb-0">
					<span class="label-text-alt text-error">
						{% for error in field.errors %}{{ error }}{% endfor %}
					</span>
				</label>
			{% endif %}
		</div>
      {% endwith %}

      {# 2. Password フィールド #}
      {% with field=form.password %}
		<div class="form-control">
			<label class="label">
				<span class="label-text">{{ field.label_tag }}</span>
			</label>
			<input type="password" 
					name="{{ field.name }}"
					id="{{ field.id_for_label }}"
					placeholder="パスワード" 
					class="input input-bordered w-full rounded-md {% if field.errors %}input-error{% endif %}" 
					x-model="password" 
					required />
			
			{% if field.errors %}
				<label class="label pb-0">
					<span class="label-text-alt text-error">
						{% for error in field.errors %}{{ error }}{% endfor %}
					</span>
				</label>
			{% endif %}
		</div>
      {% endwith %}

      {# 3. Remember Me (remember_me) フィールド #}
      {% with field=form.remember_me %}
		<div class="form-control mt-2">
			<label class="label cursor-pointer p-0">
			<span class="label-text">{{ field.label }}</span>
			<input type="checkbox" 
					name="{{ field.name }}"
					class="checkbox checkbox-sm checkbox-primary rounded-md" 
					x-model="remember_me"
					{% if field.value %}checked{% endif %} />
			</label>
		</div>
      {% endwith %}

      <div class="form-control mt-2">
        <button type="submit" class="btn btn-primary rounded-md">ログイン</button>
      </div>
      
      {# リダイレクト先を保持 #}
      {% if next %}
        <input type="hidden" name="next" value="{{ next }}" />
      {% endif %}

	  {% comment %} <label class="label pb-0">
		<a href="{% url 'password_reset' %}" class="label-text-alt link link-hover text-sm">パスワードを忘れた場合</a>
		<a href="#" class="label-text-alt link link-primary text-sm">パスワードを忘れた場合</a>
	  </label> {% endcomment %}
	  
	  <div class="mt-2">
	  	<a href="#" class="label-text-alt link link-primary text-sm">パスワードを忘れた場合</a>
	  </div>
      
    </form>
  </div>
  
  <div class="mt-8 text-center w-full max-w-sm">
    <p class="text-sm text-base-content/70 mb-4">
      アカウントをお持ちでないですか？ 
      <a href="{% url 'signup' %}" class="link link-primary">新規登録</a>
    </p>
  </div>

</div>

{% endblock %}